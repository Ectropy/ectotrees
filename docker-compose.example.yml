# Example Docker Compose for EctoTrees server with Caddy as a reverse proxy
#
# Usage:
#   1. Copy this file: cp docker-compose.example.yml docker-compose.yml
#
#   2. Create required directories 
#      mkdir -p caddy/{caddy_data,caddy_config}
#
#   3. Copy the Caddyfile to your caddy directory using
#      curl -o caddy/Caddyfile https://raw.githubusercontent.com/Ectropy/ectotrees/main/Caddyfile
#
#   4. Update your Caddyfile to use the domain you wish to host at
#      nano ./Caddyfile
#
#   5. Start: docker compose up -d


services:
  app:
    image: ghcr.io/ectropy/ectotrees:latest
    container_name: ectotrees
    environment:
      NODE_ENV: production
      PORT: 3001
    expose:
      - "3001"
    restart: unless-stopped

  caddy:
    image: caddy:latest
    container_name: caddy
    restart: unless-stopped
    ports:
      - "8085:80"
      - "8443:443"
    volumes:
      - ./caddy/Caddyfile:/etc/caddy/Caddyfile:ro
      - ./caddy/caddy_data:/data
      - ./caddy/caddy_config:/config